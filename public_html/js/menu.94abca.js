function MenuItem(){this.parent=void 0,this.element=void 0,this.data=void 0}MenuItem.prototype.setData=function(e,t){this.data=e,this.element=t,parentElement=$(t).parent();var n=$(parentElement).data("item-data");this.parent=null!=n?n:void 0,$(t).data("item-data",this)};var menuHover=void 0,menuShow=!1,menuClickEvent=!1,menuTouchEvent=!1,menuTouchEnd=!1,menuPageScroll=!1;function setProperties(e,t){for(var n in t)if(0==n.indexOf("child:")){for(var i=n.substr(6).split(":"),u=e,a=0;a<i.length;a++)u=$(u).children().eq(i[a]);null!=t[n].tag&&(u=$(u).find(t[n].tag)),setProperties(u,t[n].properties)}else"animate"!=n&&"duration"!=n&&("style"==n?t[n].length?$(e).attr(n,t[n]):$(e).removeAttr(n):$(e).css(n,t[n]))}function isDataObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}function copyMenuData(e){var t={};for(var n in e)isDataObject(e[n])?t[n]=copyMenuData(e[n]):t[n]=e[n];return t}function mergeMenuData(e,t){var n=copyMenuData(e);for(var i in t)isDataObject(n[i])&&isDataObject(t[i])?n[i]=mergeMenuData(e[i],t[i]):n[i]=t[i];return n}function Menu(){this.items=new Array}function createMenuItem(e){var t=null!=e&&null!=e.menuItemClass?e.menuItemClass:"MenuItem";return new window[t]}function createMenu(e){var t=null!=e&&null!=e.menuClass?e.menuClass:"Menu";return new window[t]}function setupMenu(e){if(menuData=getMenuData(e),null==menuData)return!1;var t=menuData.items,n=createMenu(menuData),i=$(e).parent(),u=$(i).data("item-data");null!=u&&(u.subMenu=n),n.setData(menuData,e);var a=!0;return $(e).children("li").each(function(){var e=createMenuItem(t);e.setData(t,this),n.items.push(e),$(this).children("ul").each(function(){setupMenu(this)||(a=!1)}),e.addEvents()}),n.addEvents(),a}function closeMenu(e){$(e).each(function(){var e=$(this).data("item-data");null!=e&&(null!=e.subMenu&&$(this).children("ul").each(function(){closeMenu($(this).children())}),"none"!=$(this).children().first().css("display")&&e.animate("hover_out"),e.restore(),e.open=!1,e.autoHoverOut=void 0)})}function getMenuData(e){var t=void 0,n=$(e).attr("class").split(/\s+/);return $.each(n,function(e,n){if(null!=(t=getMenuDataForClass(n)))return!1}),t}MenuItem.prototype.addEvents=function(){var e=function(e){if("touchstart"==e.type){if(menuTouchEnd=!1,0==menuTouchEvent&&(menuTouchEvent=!0,1==menuClickEvent))return}else if("touchend"==e.type&&(menuTouchEnd=!0),1==menuTouchEvent&&("touchend"==e.type||0==menuTouchEnd&&"click"==e.type))return;for(var t,n=e.target,i=$(n).data("item-data");null==i&&null!=n;)n=n.parentElement,i=$(n).data("item-data");if(n==this||"A"==this.nodeName)if(null!=i.subMenu)"none"==$(i.subMenu.element).css("display")?(i.hoverIn.call(i.element,e),i.expand()):$(i.subMenu.element).is(":animated")||setTimeout((t=i.element,function(){closeMenu(t)}),50);else{if(1==menuPageScroll)return menuPageScroll=!1,void(null!=i.hoverOut&&i.hoverOut.call(i.element));for(var u;null!=i.parent;)u=i.element,i=i.parent;setTimeout(function(e){return function(){closeMenu(e)}}(u),50)}},t=this.element,n=this.subMenu;null!=this.data.hover?($(t).hover(this.hover),null==n&&$(t).on("touchstart",this.hover)):null!=this.data.hover_in&&null!=this.data.hover_out&&($(t).hover(this.hoverIn,this.hoverOut),$(t).on("touchstart",null!=n?e:this.hoverIn),null==n&&$(t).on("touchend",e)),$(t).on("click",e)},MenuItem.prototype.getAnimationProperties=function(e,t){if(null!=e){null==this.values&&(this.values={});var n=currentDevice();if(null==this.values[n]){var i=this.element;this.values[n]={width:$(i).width(),height:$(i).height(),marginLeft:$(i).css("margin-left"),marginTop:$(i).css("margin-top")}}for(var u=n;null!=e&&u>=0&&null==e[u];)--u;u>=0&&null!=e&&(e=e[u]);var a=$.extend({},e);return"initial"==a.width?a.width=this.values[n].width:"+dx"==a.width?a.width=parseInt(this.values[n].width)+parseInt(t.dx)+"px":"dx"==a.width&&(a.width=parseInt(t.dx)+"px"),"initial"==a.height?a.height=this.values[n].height:"+dy"==a.height?a.height=parseInt(this.values[n].height)+parseInt(t.dy)+"px":"dy"==a.height&&(a.height=parseInt(t.dy)+"px"),"dx"==a.left&&(a.left=t.dx+"px"),"dy"==a.top&&(a.top=t.dy+"px"),"dy"==a.marginTop?a.marginTop=parseInt(t.dy)+"px":"-dy"==a.marginTop&&(a.marginTop=-parseInt(t.dy)+"px"),"-dy"==a.paddingTop&&(a.paddingTop=-parseInt(t.dy)+"px"),a}},MenuItem.prototype.animate=function(e,t){var n=this.element,i=null!=t&&null!=t.queue?t.queue:"fx",u=e.indexOf(":"),a=void 0;u>0&&(a=e.substring(u+1),e=e.substring(0,u));var r=this.data[e];null!=a&&(r=mergeMenuData(r,this.data[e+"_"+a])),null!=r.autoHoverOut&&(this.autoHoverOut=r.autoHoverOut),null!=r.before&&setProperties(n,this.getAnimationProperties(r.before,t));var o,s=currentDevice();if($(n).stop(i,!0).animate(this.getAnimationProperties(r.properties,t),{duration:1==r.animate?r.duration:0,queue:i,complete:(o=this.getAnimationProperties(r.after,t),function(){null==o&&(o={}),o.overflow="",setProperties(this,o)}),step:function(e,t,n){return function(){null==e&&(e={}),null==e.overflow&&(e.overflow="visible");var i=e.calc;if(null!=i){Array.isArray(i)||(i=[i]);for(var u=$(this).width(),a=0;a<i.length;a++)"marginTop"==i[a]?e.marginTop=parseInt(t.values[n].marginTop)+(parseInt(t.values[n].height)-$(this).height())+"px":"marginLeft"==i[a]?e.marginLeft=parseInt(t.values[n].marginLeft)+(parseInt(t.values[n].width)-u)+"px":"width"==i[a]&&(u=0,$(this).children("li").each(function(){u+=$(this).width(),u+=parseInt($(this).css("margin-left")),u+=parseInt($(this).css("border-left")),u+=parseInt($(this).css("margin-right")),u+=parseInt($(this).css("border-right"))}),e.width=u+1+"px")}setProperties(this,e)}}(this.getAnimationProperties(r.step,t),this,s)}).dequeue(i),null!=r.content&&this.animateContent(r.content.event,t),null!=r.submenu){var l=r.submenu.event;null!=this.subMenu&&("function"==typeof this.subMenu[l]?this.subMenu[l].call(this.subMenu.element):this.subMenu.animate(l,t))}if(null!=r.parentmenu){var h=r.parentmenu.event;null!=this.parent&&("function"==typeof this.parent[h]?this.parent[h].call(this.parent.element):this.parent.animate(h,t))}},MenuItem.prototype.animateContent=function(e,t){this.doAnimateContent(e,t)},MenuItem.prototype.doAnimateContent=function(e,t){var n=this.element,i=$(n).children().first().find(".menu-content");0==i.length&&(i=$(n).children().first());var u=this.data.content[e];null!=u.before&&setProperties(i,this.getAnimationProperties(u.before,t));var a,r=null!=t&&null!=t.queue?t.queue:"fx";for(var o in $(i).stop(r,!0).animate(this.getAnimationProperties(u.properties,t),{duration:1==u.animate?u.duration:0,queue:r,complete:(a=this.getAnimationProperties(u.after,t),function(){null!=a&&setProperties(this,a)}),step:function(e){return function(){null!=e&&setProperties(this,e)}}(this.getAnimationProperties(u.step,t))}).dequeue(r),u)if(0==o.indexOf("child:")){for(var s=o.substr(6).split(":"),l=i,h=0;h<s.length;h++)l=$(l).children().eq(s[h]);null!=u[o].tag&&(l=$(l).find(u[o].tag)),$(l).stop(r,!0).animate(this.getAnimationProperties(u[o].properties,t),{duration:1==u.animate?null!=u[o].duration?u[o].duration:u.duration:0,queue:r,complete:function(e){return function(){null!=e&&setProperties(this,e)}}(this.getAnimationProperties(u[o].after,t)),step:function(e){return function(){null!=e&&setProperties(this,e)}}(this.getAnimationProperties(u[o].step,t))}).dequeue(r)}},MenuItem.prototype.hover=function(){0!=$(this).height()&&$(this).data("item-data").animate("hover")},MenuItem.prototype.hoverIn=function(e,t){if("mouseenter"==e.type){if(1==menuTouchEvent)return;0==menuClickEvent&&(menuClickEvent=!0)}if(0!=$(this).height()){if(1!=t){var n=$(this).find("div")[0].getBoundingClientRect(),i=e.clientX;if(i<parseInt(n.left)||i>=n.right)return;var u=e.clientY;if(u<parseInt(n.top)||u>=n.bottom)return}var a=$(this).data("item-data");if(1==a.open)return;a.animate("hover_in"),a.expand(),a.open=!0,null==menuHover||menuHover==a||menuHover.element.contains(e.target)||menuHover.hoverOut.call(menuHover.element),menuHover=a}},MenuItem.prototype.hoverOut=function(e){if((1!=menuTouchEvent||null==e||"mouseleave"!=e.type)&&0!=$(this).height()){var t=$(this).data("item-data");!1!==t.autoHoverOut&&(closeMenu(t.element),t.animate("hover_out"),t.restore(),t.open=!1,t.autoHoverOut=void 0,menuHover=void 0)}},MenuItem.prototype.expand=function(){var e=this.element,t=$(e).attr("data-anim");if(null!=t){var n=t.split(";"),i=currentDevice();if(i<n.length){var u=n[i];if(u.length>0){var a,r=u.split(":"),o=r[0];if("push_right"==o)(s=r[2])<0&&(o+=":move_up"),a={dx:r[1],dy:s};else if("push_left"==o){(s=r[2])<0&&(o+=":move_up"),a={dx:r[1],dy:s}}else if("push_up"==o){a={dx:r[1],dy:r[2]}}else if("push_down"==o){a={dx:r[1],dy:r[2]}}else if("expand_up"==o){a={dx:r[1],dy:r[2]}}else if("expand_down"==o){a={dx:r[1],dy:r[2]}}else if("expand_right"==o){(s=r[2])<0&&(o+=":move_up"),a={dx:r[1],dy:s}}else if("expand_left"==o){var s;(s=r[2])<0&&(o+=":move_up"),a={dx:r[1],dy:s}}$.extend(a,{queue:"alt_fx"}),this.animate(o,a)}}}},MenuItem.prototype.restore=function(){var e=this.element,t=$(e).attr("data-anim");if(null!=t){var n=t.split(";"),i=currentDevice();if(i<n.length){var u=n[i];if(u.length>0){var a,r=u.split(":"),o=r[0];if("push_right"==o)o="pull_left",(s=r[2])<0&&(o+=":move_down"),a={dx:r[1],dy:s};else if("push_left"==o){o="pull_right",(s=r[2])<0&&(o+=":move_down"),a={dx:r[1],dy:s}}else if("push_up"==o){o="pull_down",a={dx:r[1],dy:r[2]}}else if("push_down"==o){o="pull_up",a={dx:r[1],dy:r[2]}}else if("expand_up"==o){o="shrink_down",a={dx:r[1],dy:r[2]}}else if("expand_down"==o){o="shrink_up",a={dx:r[1],dy:r[2]}}else if("expand_right"==o){o="shrink_left",(s=r[2])<0&&(o+=":move_down"),a={dx:r[1],dy:s}}else if("expand_left"==o){var s;o="shrink_right",(s=r[2])<0&&(o+=":move_down"),a={dx:r[1],dy:s}}$.extend(a,{queue:"alt_fx"}),this.animate(o,a)}}}},MenuItem.prototype.show=function(){var e=$(this).data("item-data");menuShow=!0,show(this),e.animate("show",{complete:function(){menuShow=!1,console.log("menuShow = false")}})},MenuItem.prototype.hide=function(){$(this).data("item-data").animate("hide")},Menu.prototype=new MenuItem,Menu.prototype.animateContent=function(e){for(var t in this.items){this.items[t].animateContent(e)}};var menuClasses={};function getMenuDataForClass(e){return menuClasses[e]}function registerMenuClass(e,t){menuClasses[e]=t}function initMenu(e){return!!setupMenu(e)}function currentDevice(){var e=$(".menu-device").css("background-color");return null!=e?parseInt(e.substring(4)):0}function show(e){$(e).each(function(){"none"==$(this).css("display")&&$(this).css("display","block")}),null==show.id&&(show.id=0),++show.id,$(document).on("touchend.menu."+show.id,function(e,t){return function(n){for(var i=$(e).data("item-data"),u=e;null!=i.parent;)u=i.element,i=i.parent;u.contains(n.target)||(t<=show.id&&(closeMenu(u),show.id=t-1),$(document).off("touchend.menu."+t))}}(e,show.id))}$(window).on("touchmove",function(e){menuPageScroll=!0,null!=menuHover&&menuHover.hoverOut.call(menuHover.element)});
